<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 10px; 
            margin: 0; 
        }
        .checklist-item { 
            margin: 5px 0; 
            padding: 8px; 
            border-left: 4px solid #ddd; 
        }
        .checklist-item.selected { border-left-color: #ff9800; }
        .checklist-item.signed { border-left-color: #4CAF50; }
        .complete-message { 
            padding: 10px; 
            background: #4CAF50; 
            color: white; 
            border-radius: 4px;
            margin-top: 10px;
            display: none;
        }
    </style>
</head>
<body>
    <div id="checklist"></div>
    <div id="completeMessage" class="complete-message">
        ✅ ALL SIGNATURES COMPLETE - Approver notified
    </div>

<script>
// Your 12 names and their checkbox IDs
const nameConfig = [
    { id: 'input_280_0', name: 'Rowan Isaacs', sigId: 'worker1' },
    { id: 'input_280_1', name: 'Mark Hair', sigId: 'worker2' },
    { id: 'input_280_2', name: 'Sam Mitchell', sigId: 'worker3' },
    { id: 'input_280_3', name: 'Alex Mclean', sigId: 'worker4' },
    { id: 'input_280_4', name: 'Rai Samson', sigId: 'worker5' },
    { id: 'input_280_5', name: 'Darren Taylor', sigId: 'worker6' },
    { id: 'input_280_6', name: 'Ty Wilson', sigId: 'worker7' },
    { id: 'input_280_7', name: 'Kristian', sigId: 'worker8' },
    { id: 'input_280_8', name: 'Graham Wickham', sigId: 'worker9' },
    { id: 'input_280_9', name: 'Mike Rono', sigId: 'worker10' },
    { id: 'input_280_10', name: 'Dale Roulston', sigId: 'worker11' },
    { id: 'input_280_11', name: 'John Clark', sigId: 'worker12' }
];

let checklistItems = [];
let checkInterval;

// Create checklist
function createChecklist() {
    const container = document.getElementById('checklist');
    
    nameConfig.forEach(person => {
        const item = document.createElement('div');
        item.className = 'checklist-item';
        item.id = `item_${person.id}`;
        item.innerHTML = `☐ ${person.name}`;
        container.appendChild(item);
        
        checklistItems.push({
            element: item,
            name: person.name,
            checkboxId: person.id,
            sigId: person.sigId,
            selected: false,
            signed: false
        });
    });
}

// Check status
function checkStatus() {
    let totalSelected = 0;
    let totalSigned = 0;
    let allComplete = false;
    
    checklistItems.forEach(item => {
        // Check if selected
        const checkbox = document.getElementById(item.checkboxId);
        const isSelected = checkbox ? checkbox.checked : false;
        
        // Check if signed
        let isSigned = false;
        try {
            const sigField = document.getElementById(item.sigId);
            if (sigField) {
                const canvas = sigField.querySelector('canvas');
                if (canvas) {
                    const ctx = canvas.getContext('2d');
                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    const data = imageData.data;
                    for (let i = 3; i < data.length; i += 4) {
                        if (data[i] > 0) {
                            isSigned = true;
                            break;
                        }
                    }
                }
            }
        } catch(e) {}
        
        // Update UI
        item.selected = isSelected;
        item.signed = isSigned;
        
        if (isSelected) {
            item.element.className = 'checklist-item selected';
            totalSelected++;
            
            if (isSigned) {
                item.element.className = 'checklist-item signed';
                item.element.innerHTML = `✅ ${item.name}`;
                totalSigned++;
            } else {
                item.element.innerHTML = `⏳ ${item.name}`;
            }
        } else {
            item.element.className = 'checklist-item';
            item.element.innerHTML = `☐ ${item.name}`;
        }
    });
    
    // Check if all selected are signed
    if (totalSelected > 0 && totalSelected === totalSigned) {
        allComplete = true;
    }
    
    // Show complete message
    const message = document.getElementById('completeMessage');
    if (allComplete) {
        message.style.display = 'block';
        
        // Trigger JotForm email
        triggerApprovalEmail();
    } else {
        message.style.display = 'none';
    }
}

// Trigger email in JotForm
function triggerApprovalEmail() {
    // Create hidden field that JotForm can detect
    try {
        const hiddenField = document.createElement('input');
        hiddenField.type = 'hidden';
        hiddenField.name = 'signatures_complete';
        hiddenField.value = 'true';
        document.body.appendChild(hiddenField);
        
        // Send message to parent (JotForm)
        if (window.parent) {
            window.parent.postMessage({
                action: 'signaturesComplete',
                complete: true
            }, '*');
        }
    } catch(e) {}
}

// Start checking
createChecklist();
checkInterval = setInterval(checkStatus, 1000);

// Cleanup
window.addEventListener('beforeunload', () => {
    if (checkInterval) clearInterval(checkInterval);
});
</script>
</body>
</html>
