<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Signature Checklist</title>
    <style>
        body { font-family: Arial; padding: 15px; background: white; }
        h3 { color: #333; margin-bottom: 15px; }
        .item { padding: 10px; margin: 5px 0; border-left: 4px solid #ddd; }
        .selected { border-left-color: #ff9800; background: #fff3e0; }
        .signed { border-left-color: #4CAF50; background: #e8f5e9; }
        .complete { background: #4CAF50; color: white; padding: 10px; border-radius: 5px; margin-top: 10px; display: none; }
        .complete.show { display: block; }
        .debug { background: #f5f5f5; padding: 10px; margin-top: 10px; border-radius: 5px; font-size: 12px; }
    </style>
</head>
<body>
    <h3>Signature Checklist</h3>
    <div id="checklist"></div>
    <div id="complete" class="complete">✅ ALL SIGNATURES COMPLETE</div>
    <div class="debug">
        <div id="debug">Loading...</div>
        <button onclick="forceUpdate()" style="margin-top: 5px; padding: 5px 10px;">Force Update</button>
    </div>

<script>
// JotForm field IDs
const EMAIL_FIELD_ID = 'input_363'; // Your email list field
const COMPLETE_FIELD_ID = 'input_361'; // Your completion field

// Your people with TEST emails
const PEOPLE = [
    { name: 'Rowan Isaacs', email: 'darcievaughan+rowan@gmail.com' },
    { name: 'Mark Hair', email: 'darcievaughan+mark@gmail.com' },
    { name: 'Sam Mitchell', email: 'darcievaughan+sam@gmail.com' },
    { name: 'Alex Mclean', email: 'darcievaughan+alex@gmail.com' },
    { name: 'Rai Samson', email: 'darcievaughan+rai@gmail.com' },
    { name: 'Darren Taylor', email: 'darcievaughan+darren@gmail.com' },
    { name: 'Ty Wilson', email: 'darcievaughan+ty@gmail.com' },
    { name: 'Kristian', email: 'darcievaughan+kristian@gmail.com' },
    { name: 'Graham Wickham', email: 'darcievaughan+graham@gmail.com' },
    { name: 'Mike Rono', email: 'darcievaughan+mike@gmail.com' },
    { name: 'Dale Roulston', email: 'darcievaughan+dale@gmail.com' },
    { name: 'John Clark', email: 'darcievaughan+john@gmail.com' }
];

// Find checkboxes in JotForm - THEY ARE DIFFERENT!
function findCheckboxes() {
    const checkboxes = [];
    
    // JotForm checkbox IDs are NOT input_280_0, etc.
    // They look like: input_3_0, input_3_1, etc.
    // Let's find ALL checkboxes on the page
    const allInputs = document.querySelectorAll('input[type="checkbox"]');
    
    allInputs.forEach((cb, index) => {
        // Get the checkbox label/text to identify it
        let label = '';
        const parent = cb.closest('li, .form-line, .form-field');
        if (parent) {
            const labels = parent.querySelectorAll('label');
            labels.forEach(l => {
                if (l.textContent.includes('Rowan') || l.textContent.includes('Mark') || 
                    l.textContent.includes('Sam') || l.textContent.includes('Alex') ||
                    l.textContent.includes('Rai') || l.textContent.includes('Darren') ||
                    l.textContent.includes('Ty') || l.textContent.includes('Kristian') ||
                    l.textContent.includes('Graham') || l.textContent.includes('Mike') ||
                    l.textContent.includes('Dale') || l.textContent.includes('John')) {
                    label = l.textContent.trim();
                }
            });
        }
        
        checkboxes.push({
            element: cb,
            id: cb.id || `checkbox_${index}`,
            name: cb.name,
            label: label,
            checked: cb.checked
        });
    });
    
    return checkboxes;
}

// Match people to checkboxes
function matchPeopleToCheckboxes() {
    const checkboxes = findCheckboxes();
    const matched = [];
    
    PEOPLE.forEach((person, index) => {
        let matchedCheckbox = null;
        
        // Try to find by label
        checkboxes.forEach(cb => {
            if (cb.label && person.name && cb.label.includes(person.name.substring(0, 5))) {
                matchedCheckbox = cb;
            }
        });
        
        // If not found by label, try by order
        if (!matchedCheckbox && checkboxes[index]) {
            matchedCheckbox = checkboxes[index];
        }
        
        matched.push({
            ...person,
            checkbox: matchedCheckbox,
            checkboxIndex: index
        });
    });
    
    return matched;
}

// Update checklist display
function updateChecklist() {
    const matchedPeople = matchPeopleToCheckboxes();
    const container = document.getElementById('checklist');
    const debug = document.getElementById('debug');
    
    let html = '';
    let selectedCount = 0;
    let signedCount = 0;
    const selectedEmails = [];
    
    matchedPeople.forEach(person => {
        const isSelected = person.checkbox ? person.checkbox.element.checked : false;
        const hasSignature = checkSignature(person.checkboxIndex);
        
        if (isSelected) {
            selectedCount++;
            selectedEmails.push(person.email);
            
            if (hasSignature) {
                signedCount++;
                html += `<div class="item signed">✅ ${person.name} (${person.email})</div>`;
            } else {
                html += `<div class="item selected">⏳ ${person.name} (${person.email})</div>`;
            }
        }
    });
    
    if (selectedCount === 0) {
        html = '<div>No names selected. Check names in the form above.</div>';
    }
    
    container.innerHTML = html;
    
    // Update completion banner
    const completeDiv = document.getElementById('complete');
    if (selectedCount > 0 && selectedCount === signedCount) {
        completeDiv.classList.add('show');
        updateJotFormField(COMPLETE_FIELD_ID, 'yes');
    } else {
        completeDiv.classList.remove('show');
        updateJotFormField(COMPLETE_FIELD_ID, 'no');
    }
    
    // Update email field
    if (selectedEmails.length > 0) {
        updateJotFormField(EMAIL_FIELD_ID, selectedEmails.join(', '));
    } else {
        updateJotFormField(EMAIL_FIELD_ID, '');
    }
    
    // Update debug info
    debug.innerHTML = `
        Found ${matchedPeople.length} people<br>
        Selected: ${selectedCount}<br>
        Signed: ${signedCount}<br>
        Emails: ${selectedEmails.join(', ') || 'none'}<br>
        Checkboxes found: ${matchedPeople.filter(p => p.checkbox).length}
    `;
}

// Check if signature exists (simplified for now)
function checkSignature(index) {
    // Signature fields in JotForm are probably named differently
    // We'll implement this later
    return false;
}

// Update JotForm field
function updateJotFormField(fieldId, value) {
    try {
        // Find field
        let field = document.getElementById(fieldId);
        if (!field) {
            // Try to find by name
            field = document.querySelector(`input[name*="${fieldId.replace('input_', '')}"]`);
        }
        
        if (field) {
            field.value = value;
            // Trigger change event
            const event = new Event('change', { bubbles: true });
            field.dispatchEvent(event);
            console.log(`Set ${fieldId} to: ${value}`);
            return true;
        } else {
            console.log(`Field ${fieldId} not found`);
            return false;
        }
    } catch (e) {
        console.error('Error updating field:', e);
        return false;
    }
}

// Force update
function forceUpdate() {
    updateChecklist();
}

// Initialize
function init() {
    console.log('Signature Checklist initialized');
    updateChecklist();
    setInterval(updateChecklist, 2000);
}

// Start
document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
